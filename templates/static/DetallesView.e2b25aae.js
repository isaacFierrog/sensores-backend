import{_ as H,d as R,l as U,g as m,m as E,n as q,r as S,o as v,c as f,b as O,f as a,t as g,F as z,h as j,i as w,a as y,q as J,p as K,e as Q}from"./index.82fadee2.js";import{m as W}from"./modulosService.33d67ee3.js";const X={components:{Grafica:R(()=>y(()=>import("./Grafica.b1f7c690.js"),["static/Grafica.b1f7c690.js","static/index.82fadee2.js","static/index.64017e9b.css"])),ModuloForm:R(()=>y(()=>import("./ModuloForm.1b752713.js"),["static/ModuloForm.1b752713.js","static/ModuloForm.3795a767.css","static/index.82fadee2.js","static/index.64017e9b.css"]))},setup(){const r=U(),{params:{id:c}}=r,p=m(null),o=m(null),D=2e4,h=m(null),d=m(!1),t=m([]),n=()=>M(),P=()=>d.value=!1,V=()=>d.value=!0,T=()=>{console.log("Eliminar modulo")},N=l=>Math.max(...l.map(s=>s.datos.length)),k=(l,s)=>l.map(u=>{for(;u.datos.length<s;)u.datos.push({valor:0});return u}),x=()=>{clearInterval(o.value),o.value=null},M=async()=>{try{const s=await(await W.retrieve(c)).data;console.log("Valores iniciales"),console.log(s);const u=N(s.sensores);console.log(k(s.sensores,u)),p.value=s,h.value=s.sensores.map(e=>({name:e.clave,data:e.datos.map(i=>i.valor).reverse()}));const F=s.sensores.map(e=>e.datos.map(i=>i.fecha_creacion?new Date(i.fecha_creacion).getHours():0)).flat(),I=Math.max(...F);for(let e=0;e<=I;e++)t.value.push(e);const B=s.sensores.map(e=>({name:e.clave,data:t.value.map(i=>{let A=0;for(let _=0;_<e.datos.length;_++)return(new Date(e.datos[_].fecha_creacion).getHours()||0)===i&&(console.log(e.datos[_].valor),A=e.datos[_].valor),A})}));console.log("ARREGLO TIEMP"),console.log(F),console.log("RANGO SUPERIOR"),console.log(I),console.log("LINEA DE TIEMPO"),console.log(t.value),console.log(t.value.length),console.log("DATOS SENSOR"),console.log(B),console.log("FECHA CREACION"),console.log(new Date(s.fecha_creacion).getHours()),console.log(s),console.log("DATOS PARA GRAFICAR"),console.log(h.value)}catch(l){console.log(l)}},G=E(()=>p.value.sensores||0),b=E(()=>l=>l.length?l[0].estado?"sensor--activo":"sensor--inactivo":"sensor--sinestado"),L=E(()=>l=>l.length?l[0].valor:"N/E");return M(),o.value=setInterval(()=>{M()},D),q(()=>x()),{modulo:p,referenciaPeticion:o,sensores:G,estadoSensor:b,ultimoValor:L,datos:h,verFormulario:d,lineaTiempo:t,eliminarModulo:T,editarModulo:V,ocultarFormulario:P,refrescarModulos:n}}},C=r=>(K("data-v-3dab16a6"),r=r(),Q(),r),Y={key:0,class:"modulo"},Z={class:"info"},$={class:"info__wrapper"},oo={class:"info__titulo"},eo={class:"info__zona"},ao={class:"info__mina"},so={class:"acciones"},lo={key:0,class:"sensores"},no={class:"sensor__clave"},to=C(()=>a("hr",null,null,-1)),ro={class:"grafica"},co=C(()=>a("h2",null,"Grafica de datos",-1));function io(r,c,p,o,D,h){const d=S("ModuloForm"),t=S("Grafica");return v(),f("div",null,[O(d,{modulo:o.modulo,verFormulario:o.verFormulario,onOcultarFormulario:o.ocultarFormulario,onRefrescarModulos:o.refrescarModulos},null,8,["modulo","verFormulario","onOcultarFormulario","onRefrescarModulos"]),o.modulo?(v(),f("article",Y,[a("section",Z,[a("div",$,[a("h1",oo,g(o.modulo.mac),1),a("section",null,[a("p",eo,"Area: "+g(o.modulo.area),1),a("p",ao,"Mina: "+g(o.modulo.mina),1)])]),a("section",so,[a("i",{class:"fa-solid fa-trash acciones__icono",onClick:c[0]||(c[0]=(...n)=>o.eliminarModulo&&o.eliminarModulo(...n))}),a("i",{class:"fa-solid fa-pen-to-square acciones__icono",onClick:c[1]||(c[1]=(...n)=>o.editarModulo&&o.editarModulo(...n))})])]),o.sensores?(v(),f("section",lo,[(v(!0),f(z,null,j(o.sensores,n=>(v(),f("article",{class:J(["sensor",o.estadoSensor(n.datos)]),key:n},[a("p",no,g(n.clave),1),to,a("p",null,"Ultimo valor: "+g(o.ultimoValor(n.datos)),1)],2))),128))])):w("",!0)])):w("",!0),a("section",ro,[co,O(t,{datos:o.datos,tiempo:o.lineaTiempo},null,8,["datos","tiempo"])])])}const vo=H(X,[["render",io],["__scopeId","data-v-3dab16a6"]]);export{vo as default};
